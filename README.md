# Car ML Analysis - Система анализа и предсказания цен автомобилей

Приложение с графическим интерфейсом для анализа данных об автомобилях и построения моделей машинного обучения для предсказания цен.

## Возможности

- **Загрузка данных**: Импорт CSV файлов с данными об автомобилях
- **Предобработка данных**: 
  - Удаление столбцов с большим количеством пропусков
  - Заполнение пропущенных значений (медиана для числовых, мода для категориальных)
  - One-Hot кодирование категориальных признаков
  - Удаление константных признаков
- **Анализ данных**:
  - Генерация описательной статистики
  - Визуализации (гистограммы, boxplot, тепловые карты корреляции)
  - Экспорт статистики в CSV
- **Машинное обучение**:
  - Обучение моделей (Random Forest, Linear Regression)
  - Оценка метрик (MAE, MSE, RMSE, R²)
  - Сохранение и загрузка обученных моделей
  - Предсказание цен на новых данных

## Требования

- Python 3.8+
- Зависимости (см. `requirements.txt`):
  - pandas >= 1.5
  - numpy >= 1.24
  - scipy >= 1.10
  - matplotlib >= 3.7
  - seaborn >= 0.13
  - scikit-learn >= 1.3
  - joblib >= 1.3
  - PySide6 >= 6.6

## Установка

1. Клонируйте репозиторий или скачайте архив
2. Установите зависимости:

```bash
cd CarMLAnalisys
pip install -r requirements.txt
```

## Запуск

### Запуск GUI приложения:

```bash
python main.py
```

### Запуск тестов:

```bash
python test_functionality.py
```

## Использование

### 1. Вкладка "Данные"

1. Нажмите **"Выбрать CSV"** и загрузите файл с данными
2. Просмотрите статистику и превью данных
3. Настройте параметры предобработки:
   - **Целевая колонка**: название столбца с ценами (по умолчанию: `price`)
   - **Удалить столбцы**: список столбцов для удаления через запятую
   - **Порог пропусков (%)**: максимальный процент пропусков для сохранения столбца
4. Нажмите **"Запустить предобработку"**

### 2. Вкладка "Аналитика"

1. После предобработки данных нажмите **"Запустить анализ"**
2. Выберите папку для сохранения результатов (по умолчанию: `./artifacts`)
3. Просмотрите статистику и визуализации

### 3. Вкладка "Модели"

1. Настройте параметры обучения:
   - **Test size**: доля данных для тестирования (0-1)
   - **Random state**: seed для воспроизводимости
   - **Trees (RF)**: количество деревьев для Random Forest
2. Нажмите **"Обучить модели"**
3. Просмотрите метрики обученных моделей
4. **Сохранить модель**: сохраните выбранную модель в файл `.joblib`
5. **Загрузить модель**: загрузите ранее сохраненную модель
6. **Предсказать по CSV**: загрузите новый CSV файл и получите предсказания

## Формат данных

CSV файл должен содержать:
- Числовые признаки (например: год, пробег, мощность)
- Категориальные признаки (например: марка, тип кузова, тип топлива)
- Целевую переменную (цена)

Пример структуры:

```csv
brand,model,year,mileage,engine_size,horsepower,fuel_type,transmission,price
Toyota,Sedan,2018,35000,2.0,150,Petrol,Automatic,25000
Honda,SUV,2020,15000,2.5,180,Hybrid,Automatic,32000
```

## Архитектура проекта

```
CarMLAnalisys/
├── core/                   # Основная бизнес-логика
│   ├── car_price_predictor.py  # Главный координатор
│   ├── data_loader.py          # Загрузка CSV
│   ├── data_preprocessor.py    # Предобработка данных
│   ├── data_analyzer.py        # Анализ и визуализация
│   └── model_trainer.py        # Обучение моделей
├── gui/                    # Графический интерфейс
│   ├── main_window.py          # Главное окно
│   ├── data_tab.py             # Вкладка данных
│   ├── analysis_tab.py         # Вкладка аналитики
│   └── model_tab.py            # Вкладка моделей
├── utils/                  # Утилиты
│   └── helpers.py              # Вспомогательные функции
├── main.py                 # Точка входа
├── test_functionality.py   # Тесты
├── requirements.txt        # Зависимости
└── README.md               # Документация
```

## Технические детали

### Предобработка данных

1. **Удаление столбцов с высоким процентом пропусков** (по умолчанию > 30%)
2. **Заполнение пропусков**:
   - Числовые: медиана
   - Категориальные: мода (или "Unknown" если моды нет)
3. **Удаление константных признаков** (с ≤1 уникальным значением)
4. **One-Hot кодирование** категориальных признаков

### Модели машинного обучения

- **Random Forest Regressor**: ансамблевая модель на базе деревьев решений
- **Linear Regression**: линейная регрессия

Обе модели используют sklearn Pipeline с:
- StandardScaler для числовых признаков
- OneHotEncoder для категориальных признаков

### Метрики оценки

- **MAE** (Mean Absolute Error): средняя абсолютная ошибка
- **MSE** (Mean Squared Error): средняя квадратичная ошибка
- **RMSE** (Root Mean Squared Error): корень из MSE
- **R²** (Coefficient of Determination): коэффициент детерминации

## Важные замечания

1. **Предобработка**: Перед обучением моделей обязательно выполните предобработку данных
2. **Предсказания**: При предсказании на новых данных используется метод `predict_raw`, который автоматически применяет ту же предобработку, что была использована при обучении
3. **Разрешение окна**: Приложение оптимизировано для разрешения 16:9 (1600x900)
4. **Потоки**: Все длительные операции выполняются в фоновых потоках, чтобы не блокировать интерфейс

## Решение проблем

### Ошибка при загрузке данных
- Проверьте, что CSV файл корректно отформатирован
- Убедитесь, что файл не пустой
- Проверьте кодировку файла (рекомендуется UTF-8)

### Ошибка при обучении моделей
- Убедитесь, что выполнена предобработка данных
- Проверьте, что осталось достаточно признаков после предобработки
- Убедитесь, что целевая колонка указана правильно

### Ошибка "QThread destroyed while thread is still running"
- Эта ошибка была исправлена в последней версии
- Убедитесь, что используете актуальную версию кода

## Changelog

### v1.0 (2025-11-27)
- ✅ Исправлена ошибка с потоками QThread
- ✅ Добавлена поддержка разрешения 16:9
- ✅ Улучшена обработка ошибок
- ✅ Добавлены проверки на пустые данные
- ✅ Исправлена совместимость с различными версиями scikit-learn
- ✅ Добавлен метод predict_raw для автоматической предобработки
- ✅ Создан тестовый скрипт для проверки функциональности
- ✅ Улучшена стабильность и надежность приложения
